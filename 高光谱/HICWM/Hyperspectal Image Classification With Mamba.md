# Introduction
### 在利用Mamba进行高光谱图像处理时,应该考虑的问题
- 1. 全局学习框架忽略了对局部空间的利用,具体来说,使用Mamba对图像进行建模的过程中,2d序列会被转化为1d序列,这可能在空间上断开序列中的相邻元素,从而损害局部空间完整性
- 2. 光谱和空间信息的融合与特征的提取同样重要
## 提出的框架:MambaLG
- 1.促进了空间和光谱信息的协同提取和复杂集成
- 2.局部和全局空间建模模块
- 3.短距离和长距离光谱动态感知模块
## 文章的贡献
- 1.MambaLG框架:集合SpaM,SpeM和门控注意单元
- spaM提出在保留本地的2d空间结构完整性的同时建模全局依赖关系
- 引入门控注意范式,通过函数交互形式实现光谱和空间的融合
# Methodology
## a.总体架构
![[屏幕截图 2025-09-11 172127.png]]<br>
Mamba采用双分支架构,spaM和speM是其核心,
### spaM
- 包括多尺度空间信息提取模块,局部空间相关提取模块和全局空间上下文建模模块
### speM
- 包括多尺度光谱信息提取模块,光谱提取模块和SDCC模块

- 设$f \in \mathbb{R}^{H\times W\times C}$为输入HSI,HWC分别表示行数,列数和谱带数,首先,利用$1\times 1$二维卷积,批归一化和高斯误差线性单元提取浅层特征,该过程可表示为$F_{s}= In\_head(F)$
#### spam
- 在spaM中,先利用MSFE整合不同局部空间尺度的信息,在此基础上利用LSCE方法从特征中识别出局部空间相关性,然后利用跳跃链接将多尺度空间信息和局部空间相关性结合起来
$$
F_{ms}^{spa} = MSFE_{spa}(F_s)
$$
$$
F_{spa}^l = LSCE(F_{ms}^{spa}) + F_{ms}^{spa}
$$
- GSCE用于提取全局语义,GSCE的输出$F_{spa} \in\mathbb{R}^{H\times W\times C}$可以如下获得
$$F_{spa} = GSCE(F_{spa}^l)$$
#### spem
- 在speM中,首先使用MSFE进行多尺度光谱信息的初始建模和集成,然后使用光谱分组模块进行光谱信息的粗聚类
$$
F_{ms}^{spe} = MSFE_{spe}({F_s})
$$ $$
X= Group_{m,n}(F_{ms}^{spe})
$$
- 其中,$Group_{m,n}$表示频谱分组模块,m是每个频带组中频带的数量,n是介于两个相邻频带组的起始频带之间的频带的数量
- $X = (x_1 , x_2, x_3\cdots x_g)^T \in\mathbb{R}^{g\times m}$为波段组序列,利用mamba对序列中的光谱信息进行详细分析,旨在对全局频谱信息沿着信道轴的动态变化进行建模
$$
F_{spe} = SDCC(X)
$$
其中,$F_{spe} = (w_1, w_2, w_3, \cdots w_c)\in\mathbb{R}^{1\times1\times c}$表示SDCC的处理结果,随后,通过一个通道级乘法运算,实现了通道级光谱和空间信息的耦合
$$
F_{fusion} = F_{spa}\odot F_{spe}
$$
- 用spe的输出充当$F_{spe}$的权重,从而允许光谱分支增强空间分支
- 最终,应用一个输出模块,该模块用一个$3\times3$的平均池化层组成,然后进行通道卷积,然后应用argmax函数确定图像中每个像素的类别
$$
F_{out} = Con_{1\times1}(Avgpool_{3\times3}(F_{fusion})
$$
$$
Y = argmax(F_{out})
$$
- 其中,$F_{out} = (p_1, p_2, p_3,\cdots p_k)\in\mathbb{R}^{H\times W\times K}$表示相应位置的像素属于第k类的概率
,$Y\in\mathbb{R}^{H\times W}$表示最终输出图
## b.局部全局空间语义模块
![[屏幕截图 2025-09-11 174112.png]]
### 1.局部多尺度空间特征提取(MSFE)
- 通过$1\times1,3\times3$卷积和$5\times5$平均池化分别提取不同尺度的特征,随后进行concat,再经过$1\times1$卷积层获取输出
$$
F_{ms}^{spa}= GELU(Con_{1\times1}(Cat(F_1^{spa}, F_2^{spa}, F_3^{spa}, F_s)))
$$
### 2.局部空间相关性建模
- 1.扩展图像:若原图为$H\times W$,块大小为$P\times P$,则扩展图像大小为$h=H+H\mod p, w=W+W\mod p$,特征图处理过程如下
$$
P_{i,x},P_{i,z}=chunk(linear(LN(flatten(P_i)))
$$
$$
P_{i,x}^m = S6(Silu(Conv(P_{i,x})))
$$
$$
P_{i,out} = Reshape(linear(LN(P_{i,x}^m)\odot Silu(P_{i,z}))+flatten(P_i))
$$
> 什么是chunk操作:将高维特征按指定的维度(通常是光谱维度)分为多个低维特征
- 1.特征分块与归一化
- 2.S6选择性状态空间建模
- 3.门控融合与残差链接
>什么是门控融合:门控融合承担了生成权重的作用,通过将输入映射到01之间作为权重,筛选元素
### 3.全局空间上下文建模
通过将上个模块中的输出图进行chunk,生成1d序列$T=(T_1, T_2, T_3,\cdots T_n)\in\mathbb{R}^{HW\times c}$,通过mamba块后还原并通过线性层,LN层,GELU层
## c.短距离和长距离动态光谱感知
![[屏幕截图 2025-09-11 224441.png]]
#### 1.多尺度光谱信息提取MSpeFE
- 通过两份3d卷积提取多尺度光谱信息,经过全局平均池化和元素求和整合,得到$F_{ms}^{spe}$(3d卷积得出的空缺需要零填充补全)
#### 2.短程光谱分组
定义参数m,n,将光谱分割为g个小的光谱段作为mamba输入,既保留了光谱的方向性,有减少冗余
#### 3.长程光谱动态相关聚类(SDCC)
通过mamba块处理序列通过状态更新,传递挖掘长程光谱依赖,在将输出恢复为1d序列并经过线性映射得到光谱权重
### 门控注意力输出
将光谱这块得到的权重与空间进行相乘得到特征图,特征图在经过一个$3\times 3$平均池化和$1\times1$卷积后经过argmax得出最终结果
## 损失函数
### 焦点损失函数
### l1正则化损失
