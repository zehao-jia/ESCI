# SSM的起源
## 1.1 Transformer的二次复杂度
- 现有大模型处理长文本算力消耗巨大,原因是Transformer架构中注意力机制的二次复杂度
- *1.一方面,出现针对注意力机制的魔改,也有s4,flashattention等*
- *二方面,s4,flashattention的作者也提出了新的序列模型--mamba*
## 1.2 RNN:隐藏状态$h_t$基于当前输入和前一个隐藏状态$h_{t-1}$
![alt text](<屏幕截图 2025-08-15 153114.png>)
- 问题1:$h_t$只包含此前若干步而非所有步
- 问题2:无法并行训练
## 1.3 状态空间与SSM
### 1.3.1 什么是状态空间
- 以迷宫为例
![alt text](<屏幕截图 2025-08-15 153703.png>)
- 上述迷宫可以简单建模为一个'状态空间表示',其中的每一个小框显示
> 1.当前你的x坐标<br>
> 2.当前的y坐标<br>
> 3.到出口距离<br>
- 描述这些的向量可以表示为'状态向量'
### 1.3.2状态空间模型state space model(SSM)
- SSM是用于描述这些状态并根据某些输入预测下一个状态可能是什么的模型
- 构成:
> 映射输入序列x(t),比如迷宫中的向左和向下运动<br>
> 到潜在状态表示h(t),比如到出口的距离<br>
> 并导出预测输出序列y(t),比如再次向左移动以更快到达出口<br>

![[屏幕截图 2025-08-15 155022.png]]

- 上图为SSM的表示,其中,$h_(t)$表示任意给定时间t的潜在状态表示,$x_(t)$表示某个输入,ABCD是四个可学习的矩阵

- 一般SSMs不使用离散序列,而是将连续序列作为输入并预测输出序列
### 1.3.3 SSM的两个方程
#### 1.状态表示方程$h_{t}' = Ah_{(t)} + Bx_{(t)}$
- 这个矩阵也可以表示为$h_t = Ah_{(t-1)} + Bh_t$
- $h_{(t)}$指的是任意时间的潜在状态表示,$x_{(t)}$指的是输入
#### 2.输出方程
- 输出方程描述状态如何转化为输出
### 建立对两个核心方程的统一视角
 ![[屏幕截图 2025-09-07 112342.png]]![[屏幕截图 2025-09-07 112431.png]]

# 从SSM到S4,S4D的升级
## 2.1六步升级:离散化SSM、循环表示、卷积表示、基于HiPPO处理长序列、S4、S4D
### 2.1.1离散数据连续化-零阶保持技术(zero-order hold technique)
![[屏幕截图 2025-09-07 113023.png]]
- 做法:每次收到离散的信号时,将该值保留,直到下次信号输入
- 保持该值的时间由可学习参数表示,称为步长(siz)- $\Delta$
- 通过零阶保持,将连续输出转化为离散输出
- ![[屏幕截图 2025-09-07 113734.png]]
- 这些采样值就是离散输出,可以针对AB按如下方式做零阶保持
![[屏幕截图 2025-09-07 113949.png]]
- 注意,在保存时,仍然保存矩阵A的连续形式
### 2.1.2循环结构表示:方便快速推理
每个时间步都会涉及到隐藏状态的更新,
![[屏幕截图 2025-09-07 114443.png]]
- 这个表示类似于RNN,即每个输出来自上个隐藏状态和当前输入
### 2.1.3 卷积结构表示:方便并行训练
![[屏幕截图 2025-09-07 115003.png]]从这个角度看,计算$y_3$也可以理解为计算点积:
$$

$$
$$
y_{3}= \begin{pmatrix}CA^3B & CA^2B & CA^1B & CB\end{pmatrix}
\begin{pmatrix}x_0 \\ x_1 \\ x_2 \\ x_3\end{pmatrix}
$$
这其实就是卷积的形式
### 2.1.4 长距离依赖问题的解决:Hippo
- hippo尝试将看到的所有输入信号压缩为一个系数向量
- 使用一个矩阵来构建一个捕获最近的token并衰减旧的token的状态表示
![[屏幕截图 2025-09-13 212720.png]]
由此,Hippo可以产生一个隐藏状态来记住其历史
#### Hippo的正式定义
- RNN的问题:长程记忆能力不行
- 如何改善:在获得原始输入信号时,通过一个mermory budget压缩前一段原始的input来学习特征,一个很好的想法是通过多项式近似input
- 在signal增加时,需要压缩signal并更新多项式的系数,从而引发两个问题
- ***1.如何找到最优的近似***
- ***2.如何快速更新多项式参数
- 为了解决这个问题,需要通过一个measure定义一个近似的好坏程度,例如,可以使用EDM
- 
### S4:综合ssm,离散化,Hippo
